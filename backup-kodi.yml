---
  - hosts: all
    remote_user: osmc
    vars:
      system_user: osmc
      backup_folder: ../osmc_backup

    tasks:
       - name: test if backup_folder exists
         local_action: stat path={{ backup_folder }}
         register: stat_backup_folder

       - name: make sure local backup folder is present
         local_action: shell git init {{ backup_folder }}
         when: stat_backup_folder.stat.exists == False

       - name: backup kodi configuration
         local_action: shell scp -r {{ system_user }}@{{ inventory_hostname }}:.kodi {{ backup_folder }}

       - name: backup addon database
         shell: echo '.dump' | /usr/osmc/bin/sqlite3 /home/osmc/.kodi/userdata/Database/Addons20.db > Addons.db.sql

       - name: fetch sql file
         local_action: shell scp {{ system_user }}@{{ inventory_hostname }}:Addons.db.sql {{ backup_folder }}
